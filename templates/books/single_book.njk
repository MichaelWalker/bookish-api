{% extends '../_base.njk' %}

{% block content %}
    <h1>{{ book.title }}</h1>
    {% if book.deleted %}
        <div>
            This book has been deleted and is no longer in the library.
            <form action="/books/{{ book.id }}/reinstate" method="post">
                <button type="submit">Reinstate</button>
            </form>
        </div>
    {% else %}
        <img src="{{ book.cover_image_url }}" alt="Cover Image"/>
        <div>{{ book.author }}</div>
        <div>{{ book.publisher }}</div>
        <div>{{ book.published_date }}</div>
        <div>{{ book.isbn }}</div>
        <a href="/books/{{ book.id }}/edit">Edit</a>
        <form action="/books/{{ book.id }}/delete" method="post">
            <button type="submit">Delete</button>
        </form>
        
        <h2>Copies</h2>
        <div>{{ copies.all | length }} Copies - {{ copies.available | length }} Available</div>
        <h3>Available</h3>
        <ul>
            {% for copy in copies.available %}
                <li>
                    <div>ID: {{ copy.id }}</div>
                    <div>Condition: {{ copy.condition }}</div>
                    <div>Status: {{ copy.status }}</div>
                    <a href="/copies/{{ copy.id }}/edit">Edit</a>
                    <form method="post" action="/checkouts/new-by-email">
                        <h3>Checkout Copy</h3>
                        <input type="hidden" name="copyId" value="{{ copy.id }}">
                        
                        <label>
                            Member Email:
                            <input type="text" name="email"/>
                        </label>
                        
                        <button type="submit">Assign</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
        
        <h3>On Loan</h3>
        <ul>
            {% for copy in copies.onLoan %}
                <li>
                    <div>ID: {{ copy.id }}</div>
                    <div>Condition: {{ copy.condition }}</div>
                    <div>Status: {{ copy.status }}</div>
                    <div>Current Member: {{ copy.name }}</div>
                    <div>Taken: {{ copy.out_date }}</div>
                    <a href="/copies/{{ copy.id }}/edit">Edit</a>
                    <form action="/checkouts/{{ copy.id }}/checkin" method="post">
                        <button>Return</button>
                    </form>
                </li>
            {% endfor %}
        </ul>

        <h3>Inactive</h3>
        <ul>
            {% for copy in copies.inactive %}
                <li>
                    <div>ID: {{ copy.id }}</div>
                    <div>Condition: {{ copy.condition }}</div>
                    <div>Status: {{ copy.status }}</div>
                    <a href="/copies/{{ copy.id }}/edit">Edit</a>
                </li>
            {% endfor %}
        </ul>
        <form action="/copies/new" method="post">
            <input type="hidden" name="bookId" value="{{ book.id }}"/>
            <button type="submit">Add New Copy</button>
        </form>
    {% endif %}
{% endblock %}